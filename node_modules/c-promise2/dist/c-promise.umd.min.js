!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).CPromise=e()}(this,(function(){"use strict";const t="0.13.12",e=Symbol.for("CPromise:version"),r=Symbol.for("CPromise:version:number"),n=t.split(".").reverse().reduce((t,e,r)=>t+e*Math.pow(1e3,r),0);let o=!1;var i={version:t,_version:e,versionNumber:n,_versionNumber:r,warnVersionInteraction:t=>{if(!o){o=!0;const r=t.constructor[e],n="v0.13.12 <=> "+(r?"v"+r.version:"<version older than v0.11.11>");console.warn(`Interaction of multiple versions of CPromise detected (${n}).\n      Please update your dependencies to the latest version and avoid using multiple package versions at the same time`)}return t}},s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};const{hasOwnProperty:l}=Object.prototype,c="function"==typeof setImmediate?setImmediate:function(t){setTimeout(t,0)},{toStringTag:a}=Symbol,u=t=>t&&t[a]||"";function h(t){return"function"==typeof t&&t.constructor&&"GeneratorFunction"===u(t)}function p(t){return t&&"object"==typeof t&&"function"==typeof t.next}function f(){}f.prototype=null;const d=function(t,e,r=null){return h(t)?t.apply(r,e):t&&(p(t)?t:t[Symbol.iterator]&&t[Symbol.iterator]())||null},g=(m={value:!0,set:!0,get:!0,writable:!0,enumerable:!0,configurable:!0},t=>{if(null!==t&&"object"==typeof t){const e=Object.getOwnPropertyNames(t);return e.length&&e.every(t=>m[t])}return!1});var m;const y="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==s?s:void 0;var b={isPropertyDescriptor:g,isThenable:t=>!!t&&("function"==typeof t||"object"==typeof t)&&"function"==typeof t.then,setImmediate:c,isGenerator:p,isGeneratorFunction:h,EmptyObject:f,toGenerator:d,toArray:(t,e)=>{if(t){if(Array.isArray(t))return e?t.map(e):t;if(t=d(t)){const r=[];let n;for(;(n=t.next())&&!1===n.done;)r.push(e?e(n.value):n.value);return r}}return null},getFnType:t=>"function"==typeof t&&({GeneratorFunction:"generator",AsyncFunction:"async"}[u(t)]||"plain"),lazyBindMethods:(t,e)=>{e.forEach(e=>{const r=Symbol(e+"Bound"),{value:n}=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(t,e,{get:function(){return l.call(this,r)?this[r]:this[r]=n.bind(this)},set:function(t){throw Error(`Can not rewrite method ${e} with ${t}`)},enumerable:!0,configurable:!0})})},globalObject:y,isContextDefined:t=>null!=t&&t!==y,hasOwnProperty:l,getTag:u,throttle:(t,e)=>{let r=null,n=null;const o=()=>{r&&(clearTimeout(r),r=null)},i=function(i,s){const l=Date.now(),c=e-(l-n);return s||c<=0?(t.apply(this,i),n=l,o(),!0):(r=setTimeout(()=>{t.apply(this,i),n=l},c),!1)};return i.cancel=o,i}};const{globalObject:v}=b,E=Symbol("signal"),C=Symbol("aborted"),w=Symbol("events"),S=Symbol("abort"),A=Symbol("repeatedly"),P=(()=>{try{const{AbortController:t}=v;if("function"==typeof t){const e=new t;if("[object AbortController]"===e.toString()&&-1!==e.constructor.toString().indexOf("[native code]"))return t}}catch(t){}})(),O=class{constructor(t){this[w]={},this[C]=!1,this[A]=t}get aborted(){return this[C]}addEventListener(t,e){const r=this[w];if(!r)return;const n=r[t];n?"function"==typeof n?r[t]=[n,e]:n.push(e):r[t]=e}removeEventListener(t,e){const r=this[w];if(!r)return;const n=r[t];if(!n)return;if("function"==typeof n)return void(r[t]=null);const o=n.indexOf(e);-1!==o&&(n.length>1?n.splice(o,1):r[t]=null)}dispatchEvent(t,e){if(!this[w])return;let r;const n={type:t,target:this,bubbles:!1,cancelable:!1};"function"==typeof(r=this["on"+t])&&r.call(this,n);const o=this[w][t];if(!o)return;if("function"==typeof o)return void o.call(this,t,n,e);const{length:i}=o;for(let r=0;r<i;r++)o[r].call(this,t,n,e)}[S](t){this[A]?this.dispatchEvent("abort",t):this[C]||(this[C]=!0,this.dispatchEvent("abort",t),this[w]=null)}clear(){this[w]={}}get[Symbol.toStringTag](){return"AbortSignal"}get repeatedly(){return this[A]}toString(){return"[object AbortSignal]"}},T=class{constructor(t){this[E]=null,this[A]=!!t}get signal(){return this[E]||(this[E]=new O(this[A]))}set signal(t){throw Error("signal is read-only property")}abort(t){this.signal[S](t)}get[Symbol.toStringTag](){return"AbortController"}toString(){return"[object AbortController]"}},j=t=>t&&"object"==typeof t&&"boolean"==typeof t.aborted&&"function"==typeof t.addEventListener&&"function"==typeof t.removeEventListener;var _={AbortController:P||T,AbortControllerEx:T,AbortSignalEx:O,isAbortSignal:j,isAbortController:t=>t&&"object"==typeof t&&"function"==typeof t.abort&&j(t.signal)};const{isAbortSignal:N,isAbortController:L}=_,D=(t,e,r)=>(t.type=e,r&&(t.kind=r),t),$=t=>t&&(t.type||(t=>{const e=Object.keys(R).find(e=>R[e]===t)||t.name;return e?e.replace(/[A-Z]/g,t=>"."+t.toLowerCase()):""})(t))||"",W=(...t)=>D(e=>{const{length:r}=t;for(let n=0;n<r;n++){const r=t[n](e);if(!0!==r)return r}return!0},t.map($).join(".")),x=t=>"string"==typeof t?`'${t}'`:String(t),R={null:t=>null===t,nullable:D(t=>null==t,"undefined|null"),numberFinitePositive:t=>"number"==typeof t&&Number.isFinite(t)&&t>=0,functionPlain:t=>"function"==typeof t&&t.constructor===Function,array:t=>Array.isArray(t),union:(...t)=>{const e=t.length,r=t.map($).join("|");return D(r=>{for(let n=0;n<e;n++)if(!0===t[n](r))return!0},r)},abortController:D(N,"AbortController"),abortSignal:D(L,"AbortSignal"),values:(...t)=>D(e=>-1!==t.indexOf(e),t.map(x).join("|"))};["object","boolean","number","function","string","symbol","undefined"].forEach((t,e)=>{R[t]=D(r=>typeof r===t||`a${e<1?"n":""} ${t}`,t)});const{array:I,object:U,union:k}=R;function F(t,e,r=null,n=!1){if("object"!=typeof t)throw TypeError("options must be an object");r&&r.forEach(e=>{if(void 0===t[e])throw Error(`Option ${e} is required`)});const o=Object.getOwnPropertyNames(t);let i=o.length;for(;i-- >0;){const r=o[i],s=e[r];if(s){const e=t[r],n=void 0===e||s(e);if(!0!==n)throw TypeError(`option '${r}' must be ${"string"==typeof n?n:$(s)}`)}else if(!n)throw Error(`Unknown option '${r}'`)}return t}R.object=(t,e,r=!1)=>{const n=t&&Object.entries(t).map(([t,e])=>`${t}: ${$(e)}`).join(", ");return t?W(U,D(n=>(F(n,t,e,r),!0),t?`<${n}>`:"")):U},R.array=(...t)=>{const e=t.length>1?k(...t):t[0];return W(I,D(t=>t.every(e),`<${$(e)||"*"}>`))},R.rest=(...t)=>{const e=t.length>1?k(...t):t[0];return D(e,"..."+($(e)||"*"),"rest")};var M={validators:R,validateOptions:F,validateArguments:function(t,e,{context:r="function"}={}){const{length:n}=e,o=t.length;let i,s;for(let l=0;l<n;l++){i||(s=e[l],"rest"===s.kind&&(i=!0));let n=s(t[l]);if(!0!==n){const t=n||$(s);throw TypeError(`${r} ${l>=o?"requires":"expects"} ${t} as ${l+1}th argument`)}}}};const{version:G,versionNumber:B,_version:z,_versionNumber:Y,warnVersionInteraction:q}=i,{validateOptions:H,validators:V}=M,{getTag:Z}=b,{string:J,number:K,boolean:Q}=V,{hasOwnProperty:X}=Object.prototype,tt=Symbol("scope"),et=Symbol("message"),rt=Symbol("errors"),nt=Symbol("code"),ot=Symbol("priority"),it=Symbol("forced"),st=Symbol.for("CPromise:CanceledError"),{toStringTag:lt}=Symbol,ct=class t extends Error{constructor(t,e=at,r=0,n=!1){if(super(),this.name=Z(this.constructor),this[et]=t||"canceled",this[nt]=e||at,this[tt]=null,void 0!==r&&"number"!=typeof r)throw TypeError("priority must be a number");this[it]=!!n,this[ot]=r}get scope(){return this[tt]}get message(){return this[et]}get code(){return this[nt]||""}get priority(){return this[ot]}get forced(){return this[it]}set scope(t){if(this[tt])throw Error("Scope has been already set");this[tt]=t}static from(e){const r=typeof e;if("string"===r||null==e){const r=this[rt][e];return r?(this[nt]=e,this[ot]=r[ot],this[it]=r[it],new t(r.message,e,r.priority,r.forced)):new t(e)}if("object"===r&&e instanceof Error)return e instanceof t?e:new t(e.message);throw TypeError(`unable convert ${e} to a CanceledError`)}static isCanceledError(t,...e){return t&&(t instanceof this||(t=>t[st]||"CanceledError"===Z(t.constructor)||"CanceledError"===t.constructor.name&&X.call(t,"scope"))(t)&&q(t))&&(!e.length||e.some(e=>e===t.code))}static registerErrors(t){return Object.entries(t).reduce((t,[e,r])=>(Object.defineProperty(this,e,{value:e}),"object"==typeof r?H(r,{message:J,priority:K,forced:Q}):r={message:"symbol"==typeof r?String(r).slice(7,-1):r},this[rt][e]=r,t[e]=e,t),{})}static rethrow(t,...e){if(!this.isCanceledError(t))return;const{length:r}=e;if(!r)throw t;{const{code:n}=t;for(let o=0;o<r;o++){let r=e[o];if("string"!=typeof r)throw TypeError(`CanceledError code passed as the ${o+1}th argument must be a string, got ${r}`);if(r===n)throw t}}}static get[lt](){return"CanceledError"}};Object.defineProperties(ct.prototype,{[z]:{value:G},[Y]:{value:B}}),Object.defineProperties(ct.prototype,{[st]:{value:!0}}),ct[rt]={};const{E_REASON_CANCELED:at}=ct.registerErrors({E_REASON_CANCELED:"canceled",E_REASON_TIMEOUT:"timeout",E_REASON_DISPOSED:"disposed",E_REASON_UNMOUNTED:{message:"component unmounted",priority:1/0,forced:!0}});var ut={CanceledError:ct};const{validateArguments:ht}=M,{isContextDefined:pt,isPropertyDescriptor:ft,hasOwnProperty:dt}=b,gt=t=>t&&"object"==typeof t&&"Descriptor"===t[Symbol.toStringTag],mt=function(t,e,r){return 1===arguments.length?gt(t):3===arguments.length?ft(r):void 0};const yt=(t,e,r)=>{r&&ht(e,r,{context:`@${t} decorator`})},bt=(t,e)=>{throw Error(`@${t}: ${e}`)};function vt(t){return 1===arguments.length&&"function"==typeof t||gt(t)}var Et={propertyDecorator:(t,e,r)=>function(n,o){function i(...r){return yt(n,r,e),function(t){return function(e,r,n){if(1===arguments.length)return t(e);{const{descriptor:o,finisher:i}=t.call(null,{key:r,kind:"method",placement:"function"==typeof e?"static":"prototype",descriptor:n});return i&&i(e.constructor),o}}}(e=>{if("field"!==e.kind&&"method"!==e.kind)throw Error(n+" decorator can be used for method or field");return t(e,r,{context:o,fail:bt.bind(null,n),name:n})})}return function(){const t=r&&pt(this)?r.apply(this,arguments):void 0;return void 0!==t?t:mt.apply(null,arguments)?i().apply(null,arguments):i.apply(null,arguments)}},classDecorator:(t,e,r)=>function(n,o){const i=function(...r){return yt(n,r,e),function(t){return function(e){if(1===arguments.length){if("function"==typeof e){const{descriptor:r,finisher:n}=t({kind:"class"});return n&&n(e),r}if(gt(e))return t(e)}throw new Error("cannot recognize decorator calling context")}}(e=>("class"!==e.kind&&bt(n,"can only be used for classes"),t(e,r,{context:o,fail:bt.bind(null,n),name:n})))};return function(t){const e=r&&pt(this)?r.apply(this,arguments):void 0;return void 0!==e?e:vt.apply(null,arguments)?i().apply(null,arguments):i.apply(null,arguments)}},bindDecorators:(t,e)=>{const r={};Object.entries(e).forEach(([t,e])=>{const n=Symbol(t+"Bound");r[t]={get:function(){return dt.call(this,n)?this[n]:this[n]=e(t,this)},configurable:!0,enumerable:!0}}),Object.defineProperties(t,r)}};const{CanceledError:Ct}=ut,{E_REASON_CANCELED:wt,E_REASON_TIMEOUT:St,E_REASON_DISPOSED:At,E_REASON_UNMOUNTED:Pt}=Ct,{AbortController:Ot,AbortControllerEx:Tt,isAbortSignal:jt,isAbortController:_t}=_,{validateOptions:Nt,validators:Lt}=M,{isThenable:Dt,EmptyObject:$t,setImmediate:Wt,isGeneratorFunction:xt,isGenerator:Rt,toGenerator:It,toArray:Ut,getFnType:kt,lazyBindMethods:Ft,isContextDefined:Mt,getTag:Gt,throttle:Bt,toFixed:zt}=b,{classDecorator:Yt,propertyDecorator:qt,bindDecorators:Ht}=Et,{versionNumber:Vt,_versionNumber:Zt,_version:Jt,version:Kt,warnVersionInteraction:Qt}=i,{union:Xt,array:te,functionPlain:ee,numberFinitePositive:re,number:ne,boolean:oe,string:ie,symbol:se,object:le,rest:ce,nullable:ae}=Lt,{now:ue}=Date,{isArray:he}=Array,pe=Symbol.for("toCPromise"),fe=Symbol.for("isCPromise"),de=Symbol("shadow"),ge=Symbol("events"),me=Symbol("done"),ye=Symbol("setInnerChain"),be=Symbol("promisified"),ve=Symbol("render"),{toStringTag:Ee}=Symbol,Ce=Symbol("TYPE_PROGRESS"),we=Symbol("TYPE_PAUSE"),Se=Symbol("TYPE_RESUME"),Ae=Symbol("SIGNAL_CANCEL"),Pe=Symbol("SIGNAL_PAUSE"),Oe=Symbol("SIGNAL_RESUME"),Te=()=>{},je=new Map([["disabled",0],["detached",1],["await",2],[!1,0],[!0,2],[0,0],[1,1],[2,2]]),_e=new WeakMap,Ne=class extends Promise{constructor(t,e){if(null!=e)switch(typeof e){case"string":e={label:e};break;case"number":e={timeout:e};break;case"object":break;default:throw TypeError("options must be an object|string|number")}let r,n,{label:o,weight:i,timeout:s,signal:l,nativeController:c=!1}=e||{};super((t,e)=>{r=t,n=e}),this[ge]=new $t;const a=this[de]={resolve:r,reject:n,leafsCount:0,paused:!1,timestamp:-1,innerChain:null,parent:null,progress:0,computedProgress:-1,totalWeight:-1,innerWeight:1,throttle:0,throttleTimer:0,isCaptured:!1,isListening:!1,isPending:!0,isCanceled:!1,isRejected:!1,isChain:!0,label:"",weight:1,value:void 0,nativeController:c,atomic:0,canceledWith:null};if(void 0!==l&&this.listen(l),void 0!==s&&this.timeout(s),void 0!==i&&this.weight(i),void 0!==o&&this.label(o),this.on("propagate",(t,e,r)=>{switch(t){case Ce:return a.computedProgress=-1,void(a.isListening&&this.emit("progress",this.progress(),e,r));case we:return void this.emit("pause",r,e);case Se:this.emit("resume",r,e)}}),this.on("newListener",t=>{"progress"===t&&(a.isListening=!0,a.isCaptured||this.captureProgress())}),this.on("removeListener",t=>{"progress"===t&&a.isListening&&!this.hasListeners("progress")&&(a.isListening=!1)}),null!=t){if("function"!=typeof t)throw TypeError("CPromise executor is not a function");try{t.call(this,t=>{this.resolve(t)},t=>{this.reject(t)},this)}catch(t){this.reject(t)}}}onCancel(t){}onPause(t){}onResume(t){}onCapture(t){}onDone(t){}onSignal(t,e){return 1===arguments.length&&(e=t,t=null),this.on("signal",(function(r,n){if(!t||t===r)return t?e.call(this,n):e.call(this,r,n)}))}totalWeight(t){if(arguments.length){if(t<=0||!Number.isFinite(t))throw Error("weight must be a number greater than 0");return this[de].totalWeight=t,this}return this[de].totalWeight}innerWeight(t){if(arguments.length){if(!Number.isFinite(t))throw Error("inner weight must be a number");if(t<0)throw Error("inner weight cannot be less than 0");return this[de].innerWeight=t,this}return this[de].innerWeight}progress(t,e,r){const n=this[de];if(arguments.length){if(!n.isPending)return this;if("function"==typeof t)return this.on("progress",t),this;if(!Number.isFinite(t))throw TypeError("value must be a number [0, 1]");return n.isCaptured?(t<0?t=0:t>1&&(t=1),0!==t&&1!==t&&(t=+t.toFixed(10)),n.progress!==t&&(n.progress=t,1!==t&&n.throttler?n.throttler([e,r]):this.propagate(Ce,e,r)),this):this}if(-1===n.computedProgress){-1===n.totalWeight&&this.captureProgress();const t=this.scopes(!0);let e=t.length,r=0,o=0;for(;e-- >0;){const n=t[e][de],i=n.weight;i>0&&(r+=i,o+=n.progress*i)}let i=n.totalWeight;n.computedProgress=i>0?(o+(i-r))/i:o/r}return n.computedProgress}propagate(t,e=null,r=null){return this.emit("propagate",t,r||this,e)}captureProgress(t){const e=this[de];t&&Nt(t,{throttle:re,innerWeight:re});const{throttle:r=250,innerWeight:n}=t||{};e.throttler&&e.throttler.cancel(),e.throttler=r?Bt((t,e)=>{this.propagate(Ce,t,e)},r):null,void 0!==n&&this.innerWeight(n);const o=this.scopes(!0);let i=o.length,s=0;for(;i-- >0;){const e=o[i],r=e[de],n=r.weight;if(n>0){s+=n,r.isCaptured||(r.isCaptured=!0,e.emit("capture",e));const o=r.innerChain;o&&!o[de].isCaptured&&o.captureProgress(t)}}return-1===e.totalWeight&&(e.totalWeight=s),this}scopes(t){let e=this;const r=[e];for(;(e=e[de].parent)&&(!t||e[de].isPending);)r.push(e);return r}timeout(t){const e=this[de];if(arguments.length){if(e.timer&&(e.timestamp=-1,clearTimeout(e.timer),e.timer=null),"number"!=typeof t||t<0)throw TypeError("timeout must be a positive number");return t>0&&(e.timestamp=ue(),e.timer=setTimeout(()=>{this.cancel(St)},e.timeout=t)),this}return e.timeout}get signal(){const t=this[de];return this[de].controller?this[de].controller.signal:(this[de].controller=new(t.nativeController?Ot:Tt)).signal}weight(t){if(arguments.length){if("number"!=typeof t)throw TypeError("weight must be a number");if(t<0)throw Error("weight must must be a positive number");return this[de].weight=t,this}return this[de].weight}label(t){return arguments.length?(this[de].label=t,this):this[de].label}get isPending(){return this[de].isPending}get isCanceled(){return this[de].isCanceled}get isCaptured(){return this[de].isCaptured}get isPaused(){return this.scopes(!0).some(t=>t[de].paused)}get isRejected(){return this[de].isRejected}get parent(){return this[de].parent}resolve(t){return this[me](t,!1),this}reject(t){return this[me](t,!0),this}[ye](t,e=!0){const r=this[de];r.innerChain=t,t.on("propagate",(n,o,i)=>{if(n!==Ce)this.emit("propagate",n,o,i);else{if(!e||!r.isCaptured)return;const n=t.progress();this.progress(n,i)}}),e&&(r.isCaptured&&t.captureProgress(),r.innerWeight=t[de].totalWeight)}[me](t,e){const r=this[de];if(!r.isPending)return this;const n=(t,e)=>{r.timer&&(clearTimeout(r.timer),r.timer=null);const n=()=>{r.isRejected=e,r.value=t,e?(r.isCanceled&&!r.leafsCount&&super.then(null,Te),this.emit("done",t,e),r.reject(t)):(r.isCaptured&&this.progress(1),this.emit("done",t,e),r.resolve(t)),r.isPending=!1,r.innerChain=null,r.parent&&r.parent[de].leafsCount--,r.parent=null,this[ge]=null};return e&&t&&Ct.isCanceledError(t)?(r.isCanceled=!0,t.scope||(t.scope=this),r.controller&&(r.controller.abort(),r.controller=null),this.emit("cancel",t),void n()):r.paused?this.on("resume",n):void n()};!e&&r.canceledWith&&n(r.canceledWith,!0),Dt(t)?(this.constructor.isCPromise(t)&&this[ye](t),t.then(t=>{n(t)},t=>{n(t,!0)})):n(t,e)}pause(t){return this.emitSignal(Pe,null,(function(){const e=this[de];return e.paused||(e.paused=!0,e.timer&&(clearTimeout(e.timer),e.timer=null,-1!==e.timestamp&&(e.timeLeft=ue()-e.timestamp)),this.propagate(we,t)),!0}))}resume(t){return this.emitSignal(Oe,null,(function(){const e=this[de];return e.paused&&(e.paused=!1,e.timeLeft&&(this.timeout(e.timeLeft),e.timeLeft=0),this.propagate(Se,t)),!0}))}atomic(t=2){const e=je.get(t);if(void 0===e)throw Error(`Unknown atomic type '${t}'`);return this[de].atomic=e,this}cancel(t,e=!1){let r=!1;const n=Ct.from(t);return this.emitSignal(Ae,{err:n,force:e||n.forced},(function({err:t}){return!r&&!this[de].canceledWith&&this.reject(t),!0}),({err:t,force:e},n,o,i)=>{const s=o[de],{atomic:l,parent:c}=s;if(c){const{isCanceled:e,value:n}=c[de];if(e&&t.priority<=n.priority)return r=!0,!1}return 1!==l&&(2===l?(s.canceledWith=t,!0):!(!i&&!e&&o[de].leafsCount>1)&&void 0)})}emitSignal(t,e,r,n){const o=(i,s)=>{const l=i[de];if(!l.isPending)return!1;const c=n?n.call(i,e,t,i,s):void 0;if(!1===c)return!1;if(!0!==c){let{parent:t,innerChain:e}=l;if(t&&o(t,!1))return!0;if(e&&o(e,!1))return!0}return!!(i.emitHook("signal",t,e)||r&&r.call(i,e,t,i))};return o(this,!0)}delay(t){return this.then(e=>this.constructor.delay(t,e))}aggregate(t=1){const e=new this.constructor(t=>t(this));return 1!==t?e.weight(t):e}then(t,e){if(null!=t&&"function"!=typeof t)throw TypeError("onFulfilled is not a function");if(null!=e&&"function"!=typeof e)throw TypeError("onRejected is not a function");const r=(r,o)=>{const i=n[de],s=i.isCanceled;s?(o=!0,r=i.value):o&&Ct.isCanceledError(r)&&(i.isCanceled=!0);const l=o?e||(t=>{if(!s)throw t}):t;return xt(l)?this.constructor.run(l,{resolveSignatures:!0,args:[r]}):l.call(n,r,n)},n=super.then(t?r:t=>(this[de].isCanceled&&(n[de].isCanceled=!0),t),t=>r(t,!0));return n[de].parent=this,this[de].leafsCount++,this.on("propagate",(t,e,r)=>{n.emit("propagate",t,e,r)}),n}catch(t,e){return e?super.catch((r,n)=>{if(r instanceof e)return t.call(n,r,n);throw r}):super.catch(t)}finally(t){return this.then((e,r)=>this.resolve(t.call(r,e,!1,r)).then(()=>e),(e,r)=>this.resolve(t.call(r,e,!0,r)).then(()=>this.reject(e)))}done(t){return this.then((e,r)=>t.call(r,e,!1,r),(e,r)=>t.call(r,e,!0,r))}canceled(t){return this.catch((e,r)=>{if(Ct.isCanceledError(e)){if(void 0===t)return;if("function"!=typeof t)throw TypeError("onCanceled must be a function");return t(e,r)}throw e})}static isCanceledError(t){return Ct.isCanceledError(t)}static delay(t,e,r){return new this((n,o,i)=>{if(!Number.isFinite(t))throw TypeError("delay must be a finite number");let s=setTimeout(()=>{s=0,n(e)},t);i[ve]=()=>`${Gt(i.constructor)}.delay(${t})`,i.onDone(()=>s&&clearTimeout(s));const{progressTick:l=1e3}=void 0!==r?Nt(r,{progressTick:re}):{};if(l){if(l<100)throw Error("progressTick must be grater than 100ms to avoid performance impact");const e=()=>{if(t>1.5*l){let e=Date.now();const r=setInterval(()=>{i.progress((Date.now()-e)/t)},l);i.onDone(()=>clearTimeout(r))}};i.isCaptured?e():i.onCapture(e)}})}listen(t){if(!jt(t))throw TypeError("signal should implement AbortSignal interface");const e=(t,e,r)=>{this.cancel(r)};return t.addEventListener("abort",e),this.on("done",()=>{t.removeEventListener("abort",e)}),this}static all(t,e){return new this((r,n,o)=>{let i,s,l,c,a,u=0;void 0!==e&&Nt(e,{concurrency:re,ignoreResults:oe,signatures:oe,mapper:Lt.function,args:te()});let{concurrency:h=0,ignoreResults:p,signatures:f,mapper:d,args:g=null}=e||{};const m=t=>{const{length:e}=i;let r=!1;for(let n=0;n<e;n++)i[n].cancel(t)&&(r=!0);return r};o.onCancel(m),o.onPause(()=>{const{length:t}=i;for(let e=0;e<t;e++)i[e].pause()}),o.onResume(()=>{const{length:t}=i;for(let e=0;e<t;e++)i[e].resume()}),o.onSignal((t,e)=>{const{length:r}=i;let n=!1;if(t===Ae)return m(e.err,e.force);for(let o=0;o<r;o++)i[o].emitSignal(t,e)&&(n=!0);return n});const y=(t,e,r)=>{let n=o.innerWeight();if(!n)return;let s=u;const{length:l}=i;for(let t=0;t<l;t++){const e=i[t];s+=e.progress()*e.weight()}s<=n&&o.progress(s/n,e,r)},b=t=>{n(t),m()};function v(){throw TypeError("unable to convert object to iterable")}if(o.on("capture",()=>{let t=i.length;for(;t-- >0;)i[t].progress(y);l=!0,!o.innerWeight()&&o.innerWeight((t=>{let e=t.length,r=0;for(;e-- >0;)r+=t[e][de].weight;return r})(i))}),!h)return i=Ut(t,(t,e)=>this.resolve(d?d(t,e):t,f))||v(),o[ve]=()=>`${Gt(o.constructor)}.all[${i.length}]`,super.all(i).then(r,b);he(t)&&(o[ve]=()=>`${Gt(o.constructor)}.all[${t.length}]`,o.innerWeight(t.length||1)),a=It(t,g,o)||v(),i=[],!p&&(s=[]);const E=t=>{const e=this.resolve(t,f);i.push(e),l&&e.progress(y),e.then(t=>{const n=i.indexOf(e);-1!==n&&i.splice(n,1),!p&&s.push(t),l&&(u+=e.weight()),!c&&C(),i.length||r(p?void 0:s)},b)},C=()=>{for(;!c&&i.length<h;){let t;try{t=a.next()}catch(t){return void b(t)}if(t.done)return void(c=!0);E(d?d(t.value):t.value)}};C()})}static race(t){return new this((e,r,n)=>{t=Ut(t);const{length:o}=t;n[ve]=()=>`${Gt(n.constructor)}.race[${o}]`;for(let e=0;e<o;e++)t[e]=this.resolve(t[e]);const i=e=>{let r=!1;for(let n=0;n<o;n++)t[n].cancel(e)&&(r=!0);return r};n.onCapture(()=>{let e=0;for(let r=0;r<o;r++)t[r].progress((t,r,n)=>{for(let i=0;i<o;i++)if(t>e)return e=t,r.set(t,n)})}),n.onCancel(i),n.onPause(()=>{for(let e=0;e<o;e++)t[e].pause()}),n.onResume(()=>{for(let e=0;e<o;e++)t[e].resume()}),n.onSignal((e,r)=>{if(e===Ae)return i(r.err,r.force);let n=!1;for(let i=0;i<o;i++)t[i].emitSignal(e,r)&&(n=!0);return n}),super.race(t).then(t=>{e(t),i()},t=>{r(t),i()})})}static allSettled(t,e){const{mapper:r,...n}=e||{},o=this.all(t,{...n,mapper:(t,e)=>this.resolve(r?r(t,e):t).then(t=>({status:"fulfilled",value:t}),t=>{if(Ct.isCanceledError(t))throw t;return{status:"rejected",reason:t}})});return o[ve]=()=>Gt(scope.constructor)+".allSettled",o}static retry(t,e){if("function"!=typeof t)throw TypeError("fn must be a function");void 0!==e&&Nt(e,{args:te(),retries:re,delayWeight:re,delay:Xt(re,ee),scopeArg:oe});const{args:r=[],retries:n=3,delayWeight:o=.1,delay:i=(t=>1e3*t),scopeArg:s=!1}="number"==typeof e?{retries:e}:e||{};let l=0;return new this((e,c,a)=>{const u=a[de],h=()=>{const p=[l,r],f=()=>xt(t)?this.run(t,{args:p,scopeArg:s}):new this((e,n,o)=>{e(t.apply(o,s?[o,l,r]:p))});let d=i;if(l&&"function"==typeof i&&(d=i(l,n),!re(d)))throw TypeError("delay fn must return a finite number");a[ve]=()=>`${Gt(a.constructor)}.try[${l}/${n}]`,a.progress(0);const g=(l&&d?this.delay(d).weight(o).then(f):f()).weight(.9).then(e,t=>{Ct.isCanceledError(t,wt,At,Pt)||!(++l<n)&&n?c(t):Wt(h)}).weight(0);return u.innerChain&&(u.innerChain[ge]=null),a[ye](g),g};h()})}static resolve(t,e){if(!t)return super.resolve(t);if(t instanceof this)return t;const{resolveSignatures:r=!0,atomic:n=!0}=("boolean"==typeof e?{resolveSignatures:e}:e)||{};if("object"===typeof t){if(r&&he(t)){if(1===t.length){const r=t[0];if(he(r))return this.race(r.map(t=>this.resolve(t,e)))}return this.all(t.map(t=>this.resolve(t,e)))}const o=t[pe];if("function"==typeof o){const e=o.call(t,this);return this.isCPromise(e)||this.reject(new Error(`method '${pe}()' must return a CPromise instance`)),e}if("function"==typeof t.then){const e="function"==typeof t.cancel,r=new this((r,n,{onCancel:o})=>(e&&o(e=>{try{t.cancel(e)}catch(t){n(t)}}),t.then(r,n)));return e?r:r.atomic(n)}}else if(r&&xt(t))return this.run(t);return super.resolve(t)}static promisify(t,e){const r=typeof e;"boolean"===r?e={multiArgs:!!e}:"function"===r?e={finalize:e}:void 0!==e&&Nt(e,{multiArgs:oe,finalize:ee,fnType:ie,scopeArg:oe,decorator:ee,alignArgs:oe,once:oe,types:te(Lt.values("plain","async","generator"))});const{multiArgs:n,finalize:o,fnType:i=kt(t),scopeArg:s,decorator:l,alignArgs:c=!0,once:a=!0,types:u}=e||{},h=this;if(a&&t[be])return t;if(u&&-1===u.indexOf(i))return t;const p=l&&l.call(h,t,{...e,fnType:i})||t,f=(()=>{switch(i){case"plain":return function(...e){return new h((r,i,l)=>{const a=(t,...e)=>t?i(t):n||e.length>1?r(e):r(e[0]);if(c){const r=t.length-1;e.length<r&&(e.length=r)}const u=p.apply(this,s?[l,...e,a]:[...e,a]);o&&o(u,l),Dt(u)?u.then(r,i):p.length||r(u)})};case"generator":return function(...t){return h.run(p,{context:Mt(this)?this:null,scopeArg:s,args:t})};case"async":return function(...t){return new h((e,r,n)=>{p.apply(Mt(this)?this:n,s?[n,...t]:t).then(e,r)}).atomic()}}throw TypeError("promisify requires a Function|GeneratorFunction|AsyncFunction as the first argument")})();return f[be]=i,f}static run(t,{args:e,resolveSignatures:r,context:n,scopeArg:o=!1}={}){return new this((i,s,l)=>{let c;const a=t&&t.name;if(l[ve]=()=>`${Gt(l.constructor)}.run${a?"("+a+"*)":""}`,n||(n=l),o)switch(e?e.length:0){case 0:c=t.call(n,l);break;case 1:c=t.call(n,l,e[0]);break;case 2:c=t.call(n,l,e[0],e[1]);break;default:c=t.apply(n,[l,...e])}else c=t.apply(n,e);if(!Rt(c))return s(new TypeError("function must a generator"));let u,h=0,p=0,f=0;const d=(t,e,r)=>{const n=l.innerWeight();n&&(h=(t*f+p)/n,l.progress(h,e,r))},g=t=>{if(!l[de].isCanceled)try{b(c.next(t))}catch(t){return s(t)}},m=t=>{if(!l[de].isCanceled)try{b(c.throw(t))}catch(t){s(t)}},y=()=>{u.progress(d)};!l.isCaptured&&l.onCapture(()=>{u&&y()});const b=t=>t.done?i(t.value):(u=this.resolve(t.value,{resolveSignatures:r}),l[ye](u,!1),p+=f,f=u.isChain?1:u.weight(),l.isCaptured&&y(),u.then(g,m));g()})}static async(t){}static listen(t){}static cancel(t,e){}static canceled(t){}static progress(t){}static ReactComponent(t){}static timeout(t){}static label(t){}static innerWeight(t){}static atomic(t){}static done(t){}static isPromisifiedFn(t){return t[be]||!1}static get version(){return this.prototype[Jt]}static get versionNumber(){return this.prototype[Zt]}static isCPromise(t,e){return t instanceof this||!!this[fe]&&(Qt(t),!!e)}on(t,e,r){const n=this[ge];if(!n)return this;const o=n[t],{newListener:i}=n;return o?"function"==typeof o?(o===e||(i&&this.emit("newListener",t,e),n[t]=r?[e,o]:[o,e]),this):(-1!==o.indexOf(e)||(i&&this.emit("newListener",t,e),r?o.unshift(e):o.push(e)),this):(i&&this.emit("newListener",t,e),n[t]=e,this)}hasListener(t,e){const r=this[ge];if(!r)return!1;const n=r[t];return!!n&&("function"==typeof n||-1!==n.indexOf(e))}off(t,e){if("function"!=typeof e)throw TypeError("listener must be a function");const r=this[ge];if(!r)return this;const n=r[t];if(!n)return this;if("function"==typeof n&&n===e)return r[t]=null,r.removeListener&&this.emit("removeListener",t,e),this;const o=n.length;for(let i=0;i<o;i++)if(n[i]===e)return 1===o?r[t]=null:n.splice(i,1),r.removeListener&&this.emit("removeListener",t,e),this;return this}listenersCount(t){const e=this[ge];if(!e)return 0;const r=e[t];return r?"function"==typeof r?1:r.length:0}hasListeners(t){const e=this[ge];return!(!e||!e[t])}once(t,e){const r=this;return this.on(t,(function n(){r.off(t,n),e.apply(r,arguments)}))}emit(t,...e){const r=this[ge];if(!r)return this;const n=r[t];if(!n)return this;if("function"==typeof n)return n.apply(this,e),this;for(let t=0;t<n.length;t++)n[t].apply(this,e);return this}emitHook(t,...e){const r=this[ge];if(!r)return!1;const n=r[t];if(!n)return!1;if("function"==typeof n)return!!n.apply(this,e);for(let t=0;t<n.length;t++)if(n[t].apply(this,e))return!0;return!1}static get[Ee](){return"CPromise"}toString(t){if(!t)return super.toString();const e=t=>{if(!(t instanceof this.constructor))return t.constructor.name;const r=t[de],n=t[ve],{innerChain:o,label:i}=r,s=i||n&&n.call(t)||Gt(t.constructor);return o?`${s}(${e(o)})`:s};return this.scopes().reverse().map(t=>`${e(t)}<${(t=>{if(t.isPaused)return"paused";const e=t[de];if(t.isPending)return"pending"+(-1!==e.computedProgress?`[${(100*e.computedProgress).toFixed(1)}%]`:"");const r=e.value;return`${t.isRejected?"rejected":"resolved"}${void 0===r?"":`<${r}>`}`})(t)}>`).join(" → ")}},{prototype:Le}=Ne;Le.addEventListener=Le.on,Le.removeEventListener=Le.off,Ft(Le,["Cancel","Pause","Resume","Capture","Done"].map(t=>{const e=t.toLowerCase(),r="on"+t;return Le[r]=function(t){return this.on(e,t)},r})),Ft(Ne,Object.getOwnPropertyNames(Ne).map(t=>{const{value:e}=Object.getOwnPropertyDescriptor(Ne,t);return"function"==typeof e?t:""}).filter(Boolean)),Object.defineProperties(Ne,Object.entries({CPromise:Ne,CanceledError:Ct,AbortController:Ot,AbortControllerEx:Tt,SIGNAL_CANCEL:Ae,SIGNAL_PAUSE:Pe,SIGNAL_RESUME:Oe,E_REASON_CANCELED:wt,E_REASON_TIMEOUT:St,E_REASON_DISPOSED:At,E_REASON_UNMOUNTED:Pt,ATOMIC_TYPE_DISABLED:0,ATOMIC_TYPE_DETACHED:1,ATOMIC_TYPE_AWAIT:2}).reduce((t,[e,r])=>(t[e]={value:r,configurable:!0},t),{})),Object.entries(Object.getOwnPropertyDescriptors(Le)).forEach(([t,e])=>{e.get&&void 0===e.set&&(e.set=function(){throw Error(`Can not rewrite read-only public property '${t}'`)},Object.defineProperty(Le,t,e))});const De=(t,e,r)=>{if("string"==typeof e||"symbol"==typeof e){let n=_e.get(t);n||_e.set(t,n={});return n&&n[e||""]||(r?n[e]=new Tt(!0):null)}return _t(e)?e:null},$e=(t,e,r)=>{if(jt(e))return e;const n=De(t,e,r);if(!n)throw TypeError("required AbortController|AbortSignal|string id|symbol id)");return n.signal},We=(t,e,r)=>{he(r)?r.forEach(r=>t.listen($e(e,r,!0))):t.listen($e(e,r,!0))},xe=(t,e,r)=>{const n=De(t,e,!1);return!!n&&(n&&n.abort(r),!0)},Re=(t,e)=>(t[be]=e[be],t),Ie=/^on[A-Z]/,Ue={componentDidMount:!0,shouldComponentUpdate:!0,componentWillUnmount:!0,getSnapshotBeforeUpdate:!0,componentDidUpdate:!0,componentDidCatch:!0,componentWillReceiveProps:!0},ke={async:qt((t,[e],{context:r})=>{"number"==typeof e?e={timeout:e}:"string"==typeof e&&(e={label:e});const{timeout:n,label:o,innerWeight:i,weight:s,listen:l,scopeArg:c=!1,atomic:a}=e||{},u=r.promisify(t.descriptor.value,{scopeArg:c});return t.descriptor={value:Re((function(){const t=u.apply(this,arguments);return n&&t.timeout(n),o&&t.label(o),i&&t.innerWeight(i),s&&t.weight(s),l&&We(t,this,l),void 0!==a&&t.atomic(a),t}),u),enumerable:!0,configurable:!0},t},[Xt(Lt.undefined,ne,ie,le({timeout:ne,label:ie,innerWeight:ne,weight:ne,listen:Lt.union(ie,se,te(ie,se)),scopeArg:oe,atomic:Xt(void 0,oe,Lt.values(0,1,2,"detached","disabled","await"))}))]),listen:qt((t,[e=""],{context:r})=>{const n=r.promisify(t.descriptor.value);return t.descriptor={value:Re((function(){const t=n.apply(this,arguments);return We(t,this,e),t}),n),enumerable:!0,configurable:!0},t},[ce(Lt.undefined,Lt.abortController,Lt.abortSignal,ie,se)]),cancel:qt((t,[e,r=""])=>{const n=t.descriptor.value;return t.descriptor.value=Re((function(){return xe(this,r,e||""),n.apply(this,arguments)}),n),t},[Xt(ae,ie),Xt(Lt.undefined,Lt.abortController,ie,se)],(function(t,e=""){return xe(this,e,t||"")})),canceled:qt((t,[e],{context:r})=>{const n=r.promisify(t.descriptor.value),o=e&&r.promisify(e,{types:["generator"]});return t.descriptor.value=Re((function(){return n.apply(this,arguments).canceled(o?(t,e)=>o.call(this,t,e,this):Te)}),n),t},[Xt(Lt.nullable,Lt.function)]),done:qt((t,[e],{context:r})=>{const n=r.promisify(t.descriptor.value),o=e&&r.promisify(e,{types:["generator"]});return t.descriptor.value=Re((function(){return n.apply(this,arguments).done(o?(t,e,r)=>o.call(this,t,e,r,this):Te)}),n),t},[Xt(Lt.nullable,Lt.function),Xt(Lt.nullable,oe,ie)]),progress:qt((t,[e],{context:r})=>{const n=r.promisify(t.descriptor.value);return t.descriptor.value=Re((function(){return n.apply(this,arguments).progress((t,r,n)=>e.call(this,t,r,n,this))}),n),t},[Lt.function]),ReactComponent:Yt((t,e,{context:r})=>{const{subscribeAll:n,bindMethods:o=!0,bindListeners:i=!0}=(!1===e?{subscribeAll:!1,bindMethods:!1,bindListeners:!1}:!0===e?{subscribeAll:!0}:e)||{},s={},l=o&&i,c=o||i;return{kind:"class",finisher(t){const{prototype:e}=t,a=(t,e)=>{let a=e;const u="componentWillUnmount"===t,h="componentDidMount"===t,p=t=>u?function(){return xe(this,"",Pt),t.apply(this,arguments)}:n||h?function(){return t.apply(this,arguments).listen($e(this,"",!0))}:t,f=e=>{s[t]={get(){const t=this;return function(){return e.apply(Mt(this)?this:t||this,arguments)}},configurable:!0}};xt(e)?e=p(r.promisify(e,{scopeArg:h||u})):r.isPromisifiedFn(e)&&(e=p(e)),!c||Ue[t]||!l&&!(Ie.test(t)?i:o)?e!==a&&(s[t]={value:e,configurable:!0}):f(e)};return Object.getOwnPropertyNames(e).forEach(t=>{if("constructor"===t||"render"===t)return;const r=e[t];"function"==typeof r&&a(t,r)}),"componentWillUnmount"in e||(s.componentWillUnmount={value:function(){xe(this,"",Pt)},configurable:!0}),Object.defineProperties(e,s),t}}},[Xt(Lt.undefined,oe,le({subscribeAll:oe,bindMethods:oe,bindListeners:oe}))])};Object.entries({timeout:ne,label:ie,innerWeight:ne,atomic:[Lt.undefined,oe,Lt.values(0,1,2,"detached","disabled","await")]}).forEach(([t,e])=>{ke[t]=qt((e,[r],{context:n})=>{const o=n.promisify(e.descriptor.value),i="function"==typeof r;return e.descriptor.value=Re((function(){const e=o.apply(this,arguments);return e[t](i?r.call(this,this):r)}),o),e},[he(e)?Xt(Lt.function,...e):Xt(e,Lt.function)])}),Ht(Ne,ke),Object.defineProperties(Le,{[fe]:{value:!0},[Jt]:{value:Kt},[Zt]:{value:Vt}});var Fe={CPromise:Ne,CanceledError:Ct,AbortController:Ot,AbortControllerEx:Tt,E_REASON_CANCELED:wt,E_REASON_DISPOSED:At,E_REASON_TIMEOUT:St,E_REASON_UNMOUNTED:Pt,async:Ne.async,listen:Ne.listen,cancel:Ne.cancel,ReactComponent:Ne.ReactComponent,atomic:Ne.atomic,done:Ne.done,timeout:Ne.timeout,innerWeight:Ne.innerWeight,label:Ne.label,canceled:Ne.canceled,progress:Ne.progress,promisify:Ne.promisify};const{CPromise:Me}=Fe;return Me}));
